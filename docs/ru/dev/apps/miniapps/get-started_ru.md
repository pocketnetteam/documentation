# Руководство по созданию миниприложений в Bastyon

## Содержание

- [Введение](#введение)
- [Подготовка домена](#шаг-1-подготовка-домена)
- [Быстрый старт](#быстрый-старт)
- [Регистрация миниприложения](#шаг-2-регистрация-миниприложения)
- [Управление и поиск](#шаг-3-управление-и-поиск-миниприложений)
- [Функционал миниприложений](#функционал-миниприложений)

## Введение

Эта документация предназначена для разработчиков, которые хотят быстро начать работу с миниприложениями в экосистеме Bastyon. Миниприложения позволяют интегрироваться с функционалом платформы Bastyon, включая платежи, уведомления, мессенджинг и другие возможности.

## Шаг 1: Подготовка домена

Для начала необходимо, чтобы на вашем домене были доступны два файла:

1. `b_manifest.json` — файл манифеста миниприложения
2. `b_icon.png` — иконка миниприложения

Миниприложения работают в изолированной среде и загружаются через `iframe`. Файлы должны быть доступны по корректным URL-адресам.

> **Пример структуры URL:**
> ```
> https://example.com/b_manifest.json
> https://example.com/b_icon.png
> ```

### Описание файлов

#### b_icon.png
Изображение, представляющее ваше миниприложение. Рекомендуемый размер: 512x512 пикселей.

#### b_manifest.json
Файл манифеста служит для настройки вашего миниприложения.

> **Пример структуры манифеста:**
> ```json
> {
>   "id": "demo.pocketnet.app",
>   "name": "Demo",
>   "description": "Demo application",
>   "author": "PQ8AiCHJaTZAThr2TnpkQYDyVd1Hidq4PM",
>   "scope": "demo.bastyonapps.com",
>   "permissions": [
>     "account",
>     "notifications",
>     "messaging",
>     "payment",
>     "sign",
>     "camera",
>     "gallery"
>   ]
> }
> ```

### Поля манифеста

| Поле | Описание | Формат | Обязательное |
|------|-----------|--------|--------------|
| id | Уникальный идентификатор | Доменное имя (например, `app.pocketnet`) | Да |
| name | Название миниприложения | Строка | Да |
| description | Описание миниприложения | Строка или объект локализации | Да |
| author | Адрес создателя | Адрес в Bastyon | Да |
| scope | Поддомен для миниприложения | HTTPS домен | Да |
| permissions | Список разрешений | Массив строк | Нет |

> **Пример локализации описания:**
> ```json
> "description": {
>   "en": "Demo application",
>   "ru": "Демонстрационное приложение"
> }
> ```

> **Важно:** Некоторые методы SDK работают только при наличии соответствующих разрешений. Например, открытие внешних ссылок требует специального разрешения для обеспечения безопасности.

## Быстрый старт

### Системные требования
- Node.js 14+
- npm или yarn
- HTTPS домен для размещения миниприложения

### Шаблоны для разработки

| Тип     | Репозиторий | Описание |
|---------|-------------|----------|
| Клиент  | [bastyon-miniapp-vue-template](https://github.com/DaniilKimlb/bastyon-miniapp-vue-template) | Vue.js шаблон с настроенным SDK |
| Сервер  | [bastyon-miniapp-expressjs-template](https://github.com/DaniilKimlb/bastyon-miniapp-expressjs-template) | Express.js шаблон для API |
| Клиент  | [bastyon-miniapp-html-template](https://github.com/DaniilKimlb/bastyon-miniapp-html-template) | Чистый HTML шаблон мини‑приложения |
| Клиент  | [bastyon-demo-application](https://github.com/pocketnetteam/bastyon-demo-application) | Демо‑приложение на Vue |

Шаблоны содержат преднастроенную структуру и все необходимые зависимости для быстрого старта.

## Шаг 2: Регистрация миниприложения

1. Перейдите на [страницу регистрации](https://bastyon.com/devapplication)
2. Заполните форму, следуя инструкциям
3. После заполнения миниприложение будет добавлено в режиме разработки и доступно по URL:
   ```
   https://bastyon.com/application?id=<ID вашего миниприложения>
   ```

### Публикация миниприложения

1. Зайдите в менеджмент миниприложения через:
   - Автоматический переход после регистрации
   - [Домашнюю страницу](https://bastyon.com/home), введя ваш адрес в поиске
2. Нажмите "Опубликовать" для доступа всем пользователям

## Шаг 3: Управление и поиск миниприложений

### Просмотр списка миниприложений
1. Откройте [bastyon.com/home](https://bastyon.com/home)
2. В поиске введите:
   ```
   author:<ваш адрес в Bastyon>
   ```

### Управление миниприложением
Нажмите на значок шестеренки рядом с миниприложением для доступа к панели управления.

## Функционал миниприложений

### Основные возможности
- Прием криптовалютных платежей
- Отправка уведомлений
- Мессенджинг

### Подключение SDK клиента

1. Добавьте SDK в ваш HTML:
   ```html
   <script src="https://bastyon.com/js/lib/apps/sdk.js"></script>
   ```

2. Используйте SDK в коде:
   ```javascript
   // Инициализация SDK
   const sdk = window.BastyonSdk;
   
   // Пример использования
   async function sendNotification() {
     try {
       await sdk.notifications.send({
         title: 'Привет!',
         body: 'Это тестовое уведомление'
       });
     } catch (error) {
       console.error('Ошибка отправки:', error);
     }
   }
   ```

> **Примечание:** Полное описание методов SDK доступно в [документации SDK](./sdk.md)

### Серверная часть

#### Почему необходим сервер
Поскольку Bastyon является проектом с открытым исходным кодом, пользователи могут создавать собственные сборки платформы. Для обеспечения безопасности критических операций (например, проверки платежей) рекомендуется использовать сервер для прямого взаимодействия с блокчейном.

#### PocketNet Proxy API
Используйте [PocketNet Proxy API](https://github.com/DaniilKimlb/pocketnet-proxy-api) для серверной части. API предоставляет:

- Обработку платежей
- Выполнение RPC-вызовов
- Безопасность критических операций

## Часто возникающие проблемы

### CORS ошибки
При разработке убедитесь, что ваш домен добавлен в список разрешенных источников в манифесте.

### Проблемы с SDK
Проверьте:
1. SDK подключен после загрузки DOM
2. Миниприложение запущено внутри Bastyon
3. Все необходимые разрешения указаны в манифесте

---

Для дополнительной информации и поддержки посетите [форум разработчиков Bastyon](https://bastyon.com/developers).
